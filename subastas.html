<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subastas - Nexos</title>
    <link rel="icon" href="images/favicon.svg" type="image/svg+xml">
    <link rel="shortcut icon" href="images/favicon.svg" type="image/svg+xml">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="style.css">
</head>

<body>
    <header>
        <nav class="navbar">
            <a href="index.html" class="logo">
                <i class="fas fa-heart"></i>
                <span>Nexos</span>
            </a>
            <ul class="nav-links">
                <li><a href="index.html">Inicio</a></li>
                
                <li><a href="subastas.html" class="active">Subastas</a></li>
                
                <li><a href="causas.html">Causas</a></li>
                <li><a href="empresas.html">Empresas</a></li>
                <li><a href="contacto.html">Contacto</a></li>
            </ul>
            <button class="cta-button" onclick="window.location.href='login.html'">Iniciar Sesi칩n</button>
        </nav>
    </header>

        <section class="hero" style="padding: 3rem 5%; min-height: 300px;">
            <div class="hero-content">
                <h1>Todas las Subastas</h1>
                <p>Subasta ahora y ayuda las organizaciones, y podras llevarte increibles productos </p>
            </div>
        </section>

        <main>
        <section class="trending-section">
            <h2 class="section-title">Todas las Subastas游댠</h2>

            <div class="auctions-grid">
                <!-- Las subastas se cargan din치micamente con JavaScript -->
            </div>
        </section>
    </main>
    
    <footer>
        <div class="footer-content">
            <div class="logo">
                <i class="fas fa-heart"></i>
                <span>Nexos</span>
            </div>
            <p>Conectando empresas con causas que transforman vidas</p>
            <div class="social-links">
                <a href="#"><i class="fab fa-facebook"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-linkedin"></i></a>
            </div>
            <p class="copyright">춸 2025 Nexos. Todos los derechos reservados.</p>
        </div>
    </footer>
    <script src="auth.js"></script>
    <script src="config.js"></script>
    <script>
        // Inicializar subastas de prueba si no existen
        function inicializarSubastasPrueba() {
            let subastas = JSON.parse(localStorage.getItem('nexos_subastas') || '[]');
            
            // Verificar si ya existen subastas de prueba
            const yaExistenPrueba = subastas.some(function(s) { return s.esPrueba === true; });
            
            if (!yaExistenPrueba) {
                const ahora = new Date();
                const fechaFin = new Date(ahora.getTime() + (30 * 24 * 60 * 60 * 1000)); // 30 d칤as despu칠s
                
                const subastasPrueba = [
                    {
                        id: 'prueba_1',
                        empresaId: 'prueba',
                        empresaNombre: 'Telet칩n',
                        tipo: 'subasta',
                        titulo: 'Camiseta de F칰tbol Autografiada',
                        descripcion: 'Camiseta firmada por el equipo nacional de f칰tbol de Chile. Esta exclusiva prenda deportiva cuenta con las firmas de todos los jugadores del plantel y el cuerpo t칠cnico. Los fondos recaudados beneficiar치n directamente a ni침os con c치ncer que reciben tratamiento en centros de la Telet칩n a lo largo del pa칤s.',
                        imagen: 'images/polera.png',
                        precioInicial: 50000,
                        precioActual: 85000,
                        fechaInicio: new Date(ahora.getTime() - (7 * 24 * 60 * 60 * 1000)).toISOString(),
                        fechaFin: fechaFin.toISOString(),
                        estado: 'activa',
                        participantes: ['Mar칤a Gonz치lez', 'Pedro Ram칤rez', 'Ana Torres'],
                        pujas: [],
                        esPrueba: true,
                        fechaCreacion: ahora.toISOString()
                    },
                    {
                        id: 'prueba_2',
                        empresaId: 'prueba',
                        empresaNombre: 'Fundaci칩n Duchenne',
                        tipo: 'subasta',
                        titulo: 'Consola Retro Coleccionable',
                        descripcion: 'Consola de videojuegos retro de edici칩n limitada, perfecta para coleccionistas. Incluye 50 juegos cl치sicos precargados y dos controles inal치mbricos. Esta subasta apoya la investigaci칩n del s칤ndrome de Duchenne, una enfermedad neuromuscular degenerativa que afecta principalmente a ni침os.',
                        imagen: 'images/consola.png',
                        precioInicial: 80000,
                        precioActual: 120000,
                        fechaInicio: new Date(ahora.getTime() - (5 * 24 * 60 * 60 * 1000)).toISOString(),
                        fechaFin: fechaFin.toISOString(),
                        estado: 'activa',
                        participantes: ['Carlos L칩pez', 'Sof칤a Mart칤nez', 'Diego Silva', 'Carmen Rojas'],
                        pujas: [],
                        esPrueba: true,
                        fechaCreacion: ahora.toISOString()
                    },
                    {
                        id: 'prueba_3',
                        empresaId: 'prueba',
                        empresaNombre: 'Coaniquem',
                        tipo: 'subasta',
                        titulo: 'Experiencia con Artista Nacional',
                        descripcion: 'Encuentro exclusivo y privado con un reconocido artista musical chileno. Incluye sesi칩n de fotos, aut칩grafos personalizados y una conversaci칩n 칤ntima sobre su carrera art칤stica. Esta experiencia 칰nica ayuda a Coaniquem en su labor de rehabilitaci칩n de ni침os quemados.',
                        imagen: 'images/experiencia.png',
                        precioInicial: 50000,
                        precioActual: 75000,
                        fechaInicio: new Date(ahora.getTime() - (10 * 24 * 60 * 60 * 1000)).toISOString(),
                        fechaFin: fechaFin.toISOString(),
                        estado: 'activa',
                        participantes: ['Laura P칠rez', 'Roberto N칰침ez'],
                        pujas: [],
                        esPrueba: true,
                        fechaCreacion: ahora.toISOString()
                    },
                    {
                        id: 'prueba_4',
                        empresaId: 'prueba',
                        empresaNombre: 'Fundaci칩n C치ncer Infantil',
                        tipo: 'subasta',
                        titulo: 'Paquete de Equipo Gamer',
                        descripcion: 'Set completo de gaming de 칰ltima generaci칩n que incluye: PC de alto rendimiento, monitor 4K 144Hz, teclado mec치nico RGB, mouse gamer profesional, aud칤fonos con cancelaci칩n de ruido y silla ergon칩mica. Perfecto para gamers profesionales o entusiastas. Los fondos se destinan a tratamientos oncol칩gicos pedi치tricos.',
                        imagen: 'images/setup.png',
                        precioInicial: 500000,
                        precioActual: 620000,
                        fechaInicio: new Date(ahora.getTime() - (3 * 24 * 60 * 60 * 1000)).toISOString(),
                        fechaFin: fechaFin.toISOString(),
                        estado: 'activa',
                        participantes: ['Mat칤as Fern치ndez', 'Valentina Cruz', 'Javier Morales'],
                        pujas: [],
                        esPrueba: true,
                        fechaCreacion: ahora.toISOString()
                    },
                    {
                        id: 'prueba_5',
                        empresaId: 'prueba',
                        empresaNombre: 'Hogar de Cristo',
                        tipo: 'subasta',
                        titulo: 'Polera de Jugador Profesional',
                        descripcion: 'Camiseta oficial del Colo-Colo usada y firmada por un jugador destacado del primer equipo durante la final del campeonato nacional. Incluye certificado de autenticidad y marco de exhibici칩n profesional. Esta subasta ben칠fica apoya los programas de alimentaci칩n del Hogar de Cristo.',
                        imagen: 'images/colocolo.png',
                        precioInicial: 60000,
                        precioActual: 92500,
                        fechaInicio: new Date(ahora.getTime() - (4 * 24 * 60 * 60 * 1000)).toISOString(),
                        fechaFin: fechaFin.toISOString(),
                        estado: 'activa',
                        participantes: ['Andr칠s Vargas', 'Camila Soto'],
                        pujas: [],
                        esPrueba: true,
                        fechaCreacion: ahora.toISOString()
                    },
                    {
                        id: 'prueba_6',
                        empresaId: 'prueba',
                        empresaNombre: 'Techo para Chile',
                        tipo: 'subasta',
                        titulo: 'Equipo Tecnol칩gico 칔ltima Generaci칩n',
                        descripcion: 'Laptop gaming de 칰ltima generaci칩n con procesador Intel i9, 32GB RAM, RTX 4070, SSD 2TB NVMe y pantalla 17" 240Hz. Ideal para trabajo profesional, dise침o gr치fico, edici칩n de video y gaming de alto nivel. Apoya la educaci칩n de ni침os en situaci칩n vulnerable.',
                        imagen: 'images/laptop.png',
                        precioInicial: 800000,
                        precioActual: 980000,
                        fechaInicio: new Date(ahora.getTime() - (2 * 24 * 60 * 60 * 1000)).toISOString(),
                        fechaFin: fechaFin.toISOString(),
                        estado: 'activa',
                        participantes: ['Fernando R칤os', 'Patricia Campos', 'Sebasti치n Mu침oz'],
                        pujas: [],
                        esPrueba: true,
                        fechaCreacion: ahora.toISOString()
                    },
                    {
                        id: 'prueba_7',
                        empresaId: 'prueba',
                        empresaNombre: 'Fundaci칩n C치ncer Infantil',
                        tipo: 'subasta',
                        titulo: 'Obra de Arte Original',
                        descripcion: 'Pintura al 칩leo original de un reconocido artista nacional contempor치neo. Dimensiones: 100x80 cm. Esta obra 칰nica representa el paisaje costero chileno con una t칠cnica impresionista moderna. Incluye certificado de autenticidad firmado por el artista. Los fondos apoyan la investigaci칩n m칠dica oncol칩gica.',
                        imagen: 'images/pintura.png',
                        precioInicial: 200000,
                        precioActual: 250000,
                        fechaInicio: new Date(ahora.getTime() - (6 * 24 * 60 * 60 * 1000)).toISOString(),
                        fechaFin: fechaFin.toISOString(),
                        estado: 'activa',
                        participantes: ['Gloria Herrera', 'Ricardo Pinto'],
                        pujas: [],
                        esPrueba: true,
                        fechaCreacion: ahora.toISOString()
                    },
                    {
                        id: 'prueba_8',
                        empresaId: 'prueba',
                        empresaNombre: 'Hogar de Cristo',
                        tipo: 'subasta',
                        titulo: 'Bicicleta de Monta침a Profesional',
                        descripcion: 'Bicicleta de monta침a de alta gama, ideal para competencias y rutas extremas. Incluye sistema de suspensi칩n dual, frenos de disco hidr치ulicos y cambios Shimano de 21 velocidades. Los fondos recaudados apoyan programas de vivienda social del Hogar de Cristo.',
                        imagen: 'images/setup.png',
                        precioInicial: 300000,
                        precioActual: 450000,
                        precioFinal: 450000,
                        fechaInicio: new Date(ahora.getTime() - (15 * 24 * 60 * 60 * 1000)).toISOString(),
                        fechaFin: new Date(ahora.getTime() - (1 * 24 * 60 * 60 * 1000)).toISOString(),
                        estado: 'finalizada',
                        participantes: ['Carlos M칠ndez', 'Patricia Soto', 'Roberto Fuentes', 'Daniela Vega'],
                        pujas: [
                            {
                                usuario: 'Carlos M칠ndez',
                                monto: 350000,
                                fecha: new Date(ahora.getTime() - (10 * 24 * 60 * 60 * 1000)).toISOString()
                            },
                            {
                                usuario: 'Patricia Soto',
                                monto: 380000,
                                fecha: new Date(ahora.getTime() - (8 * 24 * 60 * 60 * 1000)).toISOString()
                            },
                            {
                                usuario: 'Roberto Fuentes',
                                monto: 420000,
                                fecha: new Date(ahora.getTime() - (5 * 24 * 60 * 60 * 1000)).toISOString()
                            },
                            {
                                usuario: 'Daniela Vega',
                                monto: 450000,
                                fecha: new Date(ahora.getTime() - (3 * 24 * 60 * 60 * 1000)).toISOString()
                            }
                        ],
                        ganador: {
                            nombre: 'Daniela Vega',
                            monto: 450000,
                            fecha: new Date(ahora.getTime() - (3 * 24 * 60 * 60 * 1000)).toISOString()
                        },
                        esPrueba: true,
                        fechaCreacion: new Date(ahora.getTime() - (15 * 24 * 60 * 60 * 1000)).toISOString()
                    }
                ];

                // Agregar subastas de prueba
                subastas = subastas.concat(subastasPrueba);
                localStorage.setItem('nexos_subastas', JSON.stringify(subastas));
            }
        }

        // Cargar subastas din치micamente
        document.addEventListener('DOMContentLoaded', function() {
            inicializarSubastasPrueba();
            // Actualizar estados de subastas antes de cargar
            auth.actualizarEstadosSubastas();
            cargarSubastas();
        });

        function cargarSubastas() {
            const subastas = JSON.parse(localStorage.getItem('nexos_subastas') || '[]');
            const grid = document.querySelector('.auctions-grid');

            if (!grid) return;

            // Mostrar todas las subastas (activas y finalizadas)
            if (subastas.length === 0) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 3rem; color: #999;">' +
                    '<i class="fas fa-inbox" style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5;"></i>' +
                    '<h3>No hay subastas disponibles</h3>' +
                    '<p>Las empresas pueden crear subastas desde su perfil</p>' +
                    '</div>';
                return;
            }

            grid.innerHTML = '';
            subastas.forEach(function(subasta) {
                const card = document.createElement('div');
                card.className = 'auction-card';
                card.onclick = function() {
                    window.location.href = 'detalle-subasta.html?id=' + subasta.id;
                };
                card.style.cursor = 'pointer';

                const esFinalizada = subasta.estado === 'finalizada';

                const tipoIconos = {
                    'subasta': 'gavel',
                    'rifa': 'ticket-alt',
                    'venta': 'shopping-cart'
                };
                const icono = tipoIconos[subasta.tipo] || 'gavel';

                const imagenStyle = subasta.imagen 
                    ? 'background-image: url(' + subasta.imagen + '); background-size: cover; background-position: center;' + (esFinalizada ? ' filter: grayscale(50%); opacity: 0.85;' : '')
                    : 'background: linear-gradient(45deg, #f0f0f0 25%, transparent 25%, transparent 75%, #f0f0f0 75%), linear-gradient(45deg, #f0f0f0 25%, transparent 25%, transparent 75%, #f0f0f0 75%); background-size: 20px 20px; background-position: 0 0, 10px 10px;';

                const fechaFin = new Date(subasta.fechaFin);
                const diasRestantes = Math.ceil((fechaFin - new Date()) / (1000 * 60 * 60 * 24));

                // Formatear descripci칩n para mejor presentaci칩n
                var descripcionCorta = subasta.descripcion;
                if (descripcionCorta.length > 120) {
                    descripcionCorta = descripcionCorta.substring(0, 120).trim() + '...';
                }

                var estadoHTML = '';
                var statsHTML = '';

                if (esFinalizada) {
                    // Badge de finalizada
                    estadoHTML = '<div style="position: absolute; top: 10px; right: 10px; background: rgba(231, 76, 60, 0.95); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-weight: 700; font-size: 0.85rem; backdrop-filter: blur(10px);">' +
                        '<i class="fas fa-flag-checkered"></i> FINALIZADA' +
                        '</div>';

                    // Estad칤sticas para finalizada
                    statsHTML = '<div class="auction-stats" style="background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%); border: 2px solid #e74c3c;">' +
                        '<div class="stat">' +
                        '<span class="stat-value" style="color: #e74c3c;">$' + (subasta.precioFinal || subasta.precioActual).toLocaleString('es-CL') + '</span>' +
                        '<span class="stat-label">Pozo Final</span>' +
                        '</div>' +
                        '<div class="stat">' +
                        '<span class="stat-value" style="color: #e74c3c;">' + ((subasta.pujas || []).length) + '</span>' +
                        '<span class="stat-label">Pujas Totales</span>' +
                        '</div>' +
                        '</div>';

                    if (subasta.ganador) {
                        statsHTML += '<div style="background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%); padding: 1rem; border-radius: 10px; margin-top: 1rem; border: 2px solid #28a745;">' +
                            '<div style="text-align: center;">' +
                            '<i class="fas fa-trophy" style="color: #ffd700; font-size: 2rem; margin-bottom: 0.5rem;"></i>' +
                            '<p style="margin: 0; font-weight: 700; color: #155724; font-size: 0.9rem;">GANADOR</p>' +
                            '<p style="margin: 0.25rem 0 0 0; font-weight: 600; color: #155724;">' + subasta.ganador.nombre + '</p>' +
                            '</div>' +
                            '</div>';
                    } else {
                        statsHTML += '<div style="background: #f8f9fa; padding: 1rem; border-radius: 10px; margin-top: 1rem; text-align: center;">' +
                            '<p style="margin: 0; color: #666; font-size: 0.9rem;">Sin pujas</p>' +
                            '</div>';
                    }
                } else {
                    // Estad칤sticas para activa
                    statsHTML = '<div class="auction-stats">' +
                        '<div class="stat">' +
                        '<span class="stat-value">$' + subasta.precioActual.toLocaleString('es-CL') + '</span>' +
                        '<span class="stat-label">Precio Actual</span>' +
                        '</div>' +
                        '<div class="stat">' +
                        '<span class="stat-value">' + ((subasta.pujas || []).length) + '</span>' +
                        '<span class="stat-label">Pujas</span>' +
                        '</div>' +
                        '<div class="stat">' +
                        '<span class="stat-value">' + (diasRestantes > 0 ? diasRestantes : 0) + 'd</span>' +
                        '<span class="stat-label">Restantes</span>' +
                        '</div>' +
                        '</div>';
                }

                card.innerHTML = '<div class="card-image" style="position: relative; ' + imagenStyle + '">' + estadoHTML + '</div>' +
                    '<div class="card-content">' +
                    '<span class="auction-type"><i class="fas fa-' + icono + '"></i> ' + subasta.tipo.charAt(0).toUpperCase() + subasta.tipo.slice(1) + '</span>' +
                    '<h3 style="color: var(--dark); margin-bottom: 0.8rem; font-size: 1.3rem; line-height: 1.4;">' + subasta.titulo + '</h3>' +
                    '<p style="color: #555; line-height: 1.6; margin-bottom: 1.2rem; font-size: 0.95rem; text-align: justify;">' + descripcionCorta + '</p>' +
                    '<div class="organizer">' +
                    '<i class="fas fa-heart"></i>' +
                    '<span style="font-weight: 500;">' + subasta.empresaNombre + '</span>' +
                    '</div>' +
                    statsHTML +
                    '<button class="bid-button" onclick="event.stopPropagation(); window.location.href=\'detalle-subasta.html?id=' + subasta.id + '\'" style="margin-top: auto;">' +
                    '<i class="fas fa-eye"></i> Ver Detalles de la Subasta' +
                    '</button>' +
                    '</div>';

                grid.appendChild(card);
            });
        }
    </script>
</body>